<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <title>注册帐号</title>


    <!-- CSS -->
    <link href="/css/register/dialog.css" rel="stylesheet" type="text/css">

    <link href="/css/register/common.css" rel="stylesheet" type="text/css">

    <link href="/css/register/zh-cn_css.css" rel="stylesheet" type="text/css">



</head>

<body class="reg themeName-red" id="loginform">


<!-- 头部  -->
<div class="head-background">
    <div class="head_center">
        <div class="main-logo adHeadPicContainer" style="width:143px"><img src="/image/head-top.png"
                                                                           class="wihteBgPic"></div>
        <div class="website-name"><b style="font-size: 18px;margin-top: -5px;float: left;color:#cccccc;">|</b> <b
                style="font-size: 18px;margin-top: -3px;float: left; margin-left:18px;">地狗商城</b></div>
    </div>
</div>

<div class="wp1 relative">
    <div class="register-content" id="registerForm">
        <div class="reg-tab clearFix" style="visibility: visible;">
            <a class="phone-wrap l sel" href="javascript:void(0)" onclick="gotoRegisterByPhoneLink()"> <i
                    class="phone-icon"></i>
                <span id="tabPhone" class="tab-phone" style="width: 66px;">手机号</span>
            </a>
            <a class="mail-wrap l" href="javascript:void(0)" onclick="gotoRegisterByEmailLink()"
               style="visibility: hidden"> <i class="mail-icon"></i>
                <span id="tabMail" class="tab-email" style="width: 66px;">电子邮箱</span>
            </a>
        </div>
        <!--已有账号-->
        <div class="login r">
            已有帐号
            <a href="/user/login"
               class="login-a" title="登录">登录</a><span class="ar-eg-opposite">&gt;</span>
        </div>

        <!--注册详情-->
        <div class="reg-detail">

            <!--手机号码 -->
            <div class="input-container" id="phoneInputDiv-box">
                <div class="l input-left">
                    <span class="select-text ar-eg">+86(中国)</span>
                </div>

                <div class="r input-right"></div>
                <div class="input-content">
                    <label class="lb_opacity_Class"
                           style="display: none; position: absolute; cursor: text; float: left; z-index: 2; padding-left: 0px; padding-top: 10px;"
                           for="username">
                    </label><input id="username" class="text input-number" type="number" name="formBean.username"
                                   maxlength="20" tabindex="1" autocomplete="off" style="z-index: 1;"
                                   placeholder="请输入手机号">
                </div>
            </div>

            <div style="margin-top: 3px">
                <span id="tel_error" style="color: red; font-size: 12px; margin-left: 30px; visibility: hidden">手机号码格式错误</span>
            </div>

            <!-- 验证码 -->
            <div class="input-container" id="errRandomCode-box">
                <div class="l input-left">
                    短信验证码
                </div>
                <div class="r input-right">
                    <input type="button" class="get-code dbtn2" autocomplete="off" id="getValiCode" intervaltime="60"
                           value="获取验证码" > <span id="msg_getPhoneRandomCode"
                                                style="position: relative; top: 34px;"></span>
                    <b id="authCodeRightSms" class="authCodeRightPosFix" datavalue="false"></b>
                </div>
                <div class="input-content">
                    <label class="lb_opacity_Class"
                           style="display: block; position: absolute; cursor: text; float: left; z-index: 2; padding-left: 0px; padding-top: 10px;"
                           for="authCode">

                    </label><input type="text" autocomplete="off" class="verify vam ime-disabled text" id="authCode"
                                   tabindex="3" style="vertical-align: middle; z-index: 1;" name="formBean.authCode"
                                   send="false"
                                   maxlength="6"  placeholder="请输入短信验证码">
                </div>
            </div>

            <div style="margin-top: 3px">
                <span id="authCode_error" style="color: red; font-size: 12px; margin-left: 30px; visibility: hidden">验证码错误</span>
            </div>

            <!--昵称-->
            <div class="input-container" id="setNickname">
                <div class="l input-left">
                    昵称
                </div>
                <div class="input-content">
                    <label class="lb_opacity_Class"
                           style="display: none; position: absolute; cursor: text; float: left; z-index: 2; padding-left: 0px; padding-top: 10px;"
                           for="nickname">
                    </label><input oncut="return false;" oncopy="return false" type="text" autocomplete="off"
                                   class="pwd-input text" id="nickname" name="formBean.password" maxlength="16"
                                   tabindex="4" style="z-index: 1;"  placeholder="请输入昵称">
                </div>
            </div>

            <div style="margin-top: 3px">
                <span id="nickname_error" style="color: red; font-size: 12px; margin-left: 30px; visibility: hidden">昵称长度不得小于4</span>
            </div>

            <!-- 设置密码 -->
            <div class="set-password">
                <div class="input-container" id="pwdDiv">
                    <div class="l input-left">
                        密码
                    </div>
                    <div class="input-content">
                        <label class="lb_opacity_Class"
                               style="display: none; position: absolute; cursor: text; float: left; z-index: 2; padding-left: 0px; padding-top: 10px;"
                               for="password">
                        </label><input oncut="return false;" oncopy="return false" type="password" autocomplete="off"
                                       class="pwd-input text" id="password"  maxlength="32"
                                       tabindex="4" style="z-index: 1;" placeholder="请输入密码">
                    </div>
                </div>
                <div style="margin-top: 3px">
                    <span id="password_error" style="color: red; font-size: 12px; margin-left: 30px; visibility: hidden">密码长度不得小于8</span>
                </div>
                <div id="msg_password"></div>
                <div id="pwd_check_dialog"></div>

                <div class="input-container " id="confirmpwdDiv">
                    <div class="l input-left">
                        确认密码
                    </div>
                    <div class="input-content">
                        <label class="lb_opacity_Class"
                               style="display: block; position: absolute; cursor: text; float: left; z-index: 2; padding-left: 0px; padding-top: 10px;"
                               for="confirmPwd">

                        </label><input oncut="return false;" oncopy="return false" id="confirmPwd" type="password"
                                       autocomplete="off" class="text vam" name="checkPassword" maxlength="32"
                                       tabindex="5"  style="z-index: 1;" placeholder="请再次输入密码">
                    </div>
                </div>
                <div style="margin-top: 3px">
                    <span id="checkPassword_error" style="color: red; font-size: 12px; margin-left: 30px; visibility: hidden">两次密码不相同</span>
                </div>
                <div id="msg_checkPassword"></div>
                <!-- 按钮 -->
                <div class="reg-btn" align="center">
                    <input type="button" class="btn btn-reg sel" id="btnSubmit" value="注册" tabindex="7">
                    <div id="register_msg" style="position: relative; left: 26%;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript">
    var wait = 60;
    $(function () {
        $('#getValiCode').click(function () {
            var tel = $('#username').val();
            if (!(/^1[34578]\d{9}$/.test(tel))) {
                $('#tel_error').css("visibility","visible");
            } else {
                $.get("http://localhost:7006/user/sendVerCode/" + tel);
                $('#getValiCode').attr("send", "true");
                time();
            }
        })
    });
    $('#btnSubmit').click(function () {
        var tel = $('#username').val();
        var authCode = $('#authCode').val();
        var nickname = $('#nickname').val();
        var password = $('#password').val();
        var confirmPwd = $('#confirmPwd').val();
        if (tel == '') {
            $('#tel_error').css("visibility","visible");
        } else if (authCode == '') {
            $('#authCode_error').css("visibility","visible");
        } else if (nickname == '') {
            $('#nickname_error').css("visibility","visible");
        } else if (password == '') {
            $('#password_error').css("visibility","visible");
        } else if (password != confirmPwd) {
            $('#checkPassword_error').css("visibility","visible");
        }
        $.ajax({
            type: "POST",
            url: "http://localhost:7006/user/register",
            data: JSON.stringify({
                "password" : password,
                "nickname" : nickname,
                "mobile" : tel,
                "verCode" : authCode
            }),
            contentType: "application/json",
            dataType: "json",
            success: function (data) {
                if (data.code != 200) {
                    if (data.message == "用户手机号已存在") {
                        $('#tel_error').css("visibility","visible").html("手机号已存在");
                    } else if (data.message == "验证码错误") {
                        $('#authCode_error').css("visibility","visible");
                    } else if (data.message == "用户昵称已存在") {
                        $('#nickname_error').css("visibility","visible").html("昵称已存在");
                    }
                } else {
                    // 注册成功
                }
            }
        })
    });

    $('#nickname').focus(function () {
        $('#nickname_error').css("visibility","hidden").html("昵称长度不得小于4");
    });
    $('#nickname').blur(function () {
        var nickname = $('#nickname').val();
        if (nickname.length < 4) {
            $('#nickname_error').css("visibility","visible");
        }
    });
    $('#password').focus(function () {
        $('#password_error').css("visibility","hidden").html("密码长度不得小于8");
    });
    $('#password').blur(function () {
        var password = $('#password').val();
        if (password.length < 8) {
            $('#password_error').css("visibility","visible");
        }
    });
    $('#confirmPwd').focus(function () {
        $('#checkPassword_error').css("visibility","hidden");
    });
    $('#confirmPwd').blur(function () {
        var password = $('#password').val();
        var confirmPwd = $('#confirmPwd').val();
        if (password != confirmPwd) {
            $('#checkPassword_error').css("visibility","visible");
        }
    });
    $("#authCode").focus(function () {
        $('#authCode_error').css("visibility","hidden");
    });
    $("#authCode").blur(function () {
        if ($('#authCode').val().length != 6) {
            $('#authCode_error').css("visibility","visible");
        }
    });

    $("#username").focus(function () {
        $('#tel_error').css("visibility", "hidden").html("手机号码格式错误");
    });
    $("#username").blur(function () {
        var tel = $('#username').val();
        if (!(/^1[34578]\d{9}$/.test(tel))) {
            $('#tel_error').css("visibility", "visible");
        }
    });


    function time() {
        if (wait == 0) {
            $('#getValiCode').removeAttr("disabled").val("获取验证码");
            wait = 60;
        } else {
            $('#getValiCode').attr("disabled", "disabled").val(wait + "秒可重试");
            wait--;
            setTimeout(function() {
                    time()
                },
                1000)
        }
    }
</script>
</body>
</html>